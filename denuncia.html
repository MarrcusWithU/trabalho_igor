<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fazer den√∫ncia</title>
  <link rel="stylesheet" href="denuncia.css" />
</head>

<body>
  <div class="menu-lateral">
    <div class="menu">Menu</div>
    <br />
    <button class="btn_home">üè† Home</button>
    <button class="btn_perfil">üòä Meu Perfil</button>
    <button class="btn_apoiar">‚ù§Ô∏è Seja um apoiador</button>
    <button class="btn_denuncia">üìã Minhas Den√∫ncias</button>
    <button class="btn_sair">‚úã Sair da conta</button>
  </div>

  <div class="content">
    <div class="header">
      <div>
        <p><img src="imagens/logo.png" alt="logo principal" class="logo_principal" /></p>
      </div>

      <div class="menu_buttons">
        <button id="btnDenuncia">üì© Fazer Den√∫ncia</button>
        <button id="btnFaleConosco">üìûFale Conosco</button>
        <button id="btnPesquisa">üîç Pesquisa</button>
      </div>
    </div>

    <div class="rainbow-line"></div>

    <div class="titulo">FAZER DEN√öNCIA</div>

    <form id="formDenuncia">
      <div class="form-grid">
        <div class="descricao">
          <label for="tipo">TIPO DE DEN√öNCIA *</label>
          <select id="tipo" required>
            <option selected disabled>Selecione o tipo de den√∫ncia</option>
            <option>Homofobia</option>
            <option>Transfobia</option>
            <option>Bifobia</option>
            <option>Lesbofobia</option>
            <option>Viol√™ncia f√≠sica</option>
            <option>Viol√™ncia verbal</option>
            <option>Agress√£o psicol√≥gica</option>
            <option>Discrimina√ß√£o no trabalho</option>
            <option>Discrimina√ß√£o em ambiente escolar</option>
            <option>Nega√ß√£o de atendimento ou servi√ßo</option>
            <option>Viola√ß√£o de direitos humanos</option>
            <option>Outro</option>
          </select>
        </div>

        <div class="descricao">
          <label for="descricao">DESCRI√á√ÉO DO OCORRIDO *</label>
          <textarea id="descricao" rows="4" required placeholder="Descreva como aconteceu o ocorrido"></textarea>
        </div>

        <div class="descricao">
          <label for="anonimo">DESEJA MANTER DE FORMA AN√îNIMA?</label>
          <select id="anonimo">
            <option>Sim</option>
            <option>N√£o</option>
          </select>
        </div>

        <div class="descricao">
          <label for="local">LOCAL DA OCORR√äNCIA *</label>
          <textarea id="local" rows="2" required placeholder="Cidade / Estado&#10;Nome do local"></textarea>
        </div>

        <div class="descricao">
          <label for="anexos">ANEXOS (OPCIONAL)</label>
          <input type="file" id="anexos" />
        </div>

        <div class="descricao">
          <label for="apoio">DESEJA RECEBER APOIO?</label>
          <select id="apoio">
            <option>Quero ser contatado por uma rede de apoio confi√°vel</option>
            <option>S√≥ quero registrar a den√∫ncia por agora</option>
          </select>
        </div>

        <div class="descricao">
          <label for="data">DATA DA OCORR√äNCIA *</label>
          <input type="date" id="data" required />
        </div>

        <div class="descricao">
          <label for="vitima">INFORMA√á√ïES SOBRE A V√çTIMA (OPCIONAL)</label>
          <textarea id="vitima" placeholder="Como a v√≠tima est√° ap√≥s o ocorrido?"></textarea>
        </div>
      </div>

      <div class="submit-button">
        <button type="submit">üßæ ENVIAR</button>
      </div>
    </form>

    <img src="imagens/denuncia.png" class="img" />
  </div>

  <script>
    // Menu lateral
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelector('.btn_home').addEventListener('click', () => {
        window.location.href = 'principal.html';
      });

      document.querySelector('.btn_perfil').addEventListener('click', () => {
        window.location.href = 'perfil.html';
      });

      document.querySelector('.btn_denuncia').addEventListener('click', () => {
        window.location.href = 'verdenuncia.html';
      });

      document.querySelector('.btn_sair').addEventListener('click', () => {
        localStorage.removeItem('usuarioLogado');
        window.location.href = 'login.html';
      });
    });
  </script>

  <script>
    // A√ß√µes dos bot√µes no canto superior direito
    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("btnDenuncia").addEventListener("click", function () {
        window.location.href = "denuncia.html"; // o nome do arquivo da p√°gina de den√∫ncia
      });

      document.getElementById("btnFaleConosco").addEventListener("click", function () {
        alert("Entre em contato conosco:\n\nEmail 1: contato@lgbtqiap.org\nEmail 2: suporte@lgbtqiap.org\nTelefone: (11) 99999-9999");
      });

      document.getElementById("btnPesquisa").addEventListener("click", function () {
        alert("Funcionalidade de pesquisa ainda n√£o implementada.");
      });
    });
  </script>

  <script>
    // Envio do formul√°rio
    document.getElementById('formDenuncia').addEventListener('submit', function (event) {
      event.preventDefault();

      const tipo = document.getElementById('tipo').value;
      const descricao = document.getElementById('descricao').value.trim();
      const anonimo = document.getElementById('anonimo').value;
      const local = document.getElementById('local').value.trim();
      const apoio = document.getElementById('apoio').value;
      const data = document.getElementById('data').value;
      const vitima = document.getElementById('vitima').value.trim();

      const usuario = JSON.parse(localStorage.getItem('usuarioLogado'));
      const id_usuario = usuario ? usuario.id : null;

      const denuncia = {
        tipo,
        descricao,
        anonimo,
        local,
        apoio,
        data,
        vitima,
        id_usuario,
      };

      fetch('http://localhost:3000/denuncias', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(denuncia),
      })
        .then((res) => {
          if (!res.ok) throw new Error('Erro ao enviar den√∫ncia');
          return res.json();
        })
        .then((data) => {
          alert(data.mensagem);
          document.getElementById('formDenuncia').reset();
        })
        .catch((err) => {
          console.error(err);
          alert('Erro ao enviar den√∫ncia, tente novamente.');
        });
    });
  </script>
</body>

</html>